import{_ as W}from"./AppSelect.vue.a2e355e3.js";import{_ as H}from"./AppTextField.vue.badc1057.js";import{d as I,G as O,r as u,o as z,a as G,b as Y,e,w as a,g as r,V as i,f as q,i as J,F as K}from"./entry.0516b5e8.js";import{b as T}from"./index.c17c83dc.js";import{a as S}from"./index.b416cb81.js";import{a as p}from"./axios.28bc18a3.js";import{u as N,w as Q}from"./xlsx.f5126985.js";import{u as X}from"./emp.b2d779b9.js";import{V as Z,a as ee}from"./VTabs.eb6de54f.js";import{V as c,a as g,c as te}from"./VCard.c238dd74.js";import{V as ae,a as le}from"./VWindowItem.20662481.js";import{V as U}from"./VRow.a53f6339.js";import{V as f}from"./VCol.c943daa7.js";import{V as oe}from"./VDataTable.781ea32f.js";import{V as se}from"./VContainer.90c46cbd.js";import{V as ue}from"./VTextarea.30e1484f.js";import{V as re}from"./VDialog.83d7608d.js";import"./VCheckboxBtn.759eed6f.js";import"./VDivider.c8eb66ff.js";import"./VSelect.c3f72c74.js";import"./VMenu.8605d140.js";import"./createSimpleFunctional.63f646df.js";import"./VAvatar.dac40cd4.js";import"./index.010e4494.js";/* empty css              */const de={class:"text-center"},$e=I({__name:"approval",setup(ne){const j=O(),v=X();v.loadEmpCode(),console.log("현재 로그인된 직원 코드:",v.empCode),v.empCode!=="EMP-01"&&v.empCode!=="EMP-00"&&j.push("/hr/confinement/unauthorized");const V=u("personal-info"),_=u("");u("");const E=u([]),w=u(""),L=u([]),h=u(""),C=u(""),s=u([]),y=u(""),m=u(!1),k=u(""),x=u([]),D=u([]),R=[{title:"교육코드",key:"eduCode",width:80},{title:"교육명",key:"eduName",width:80},{title:"직원코드",key:"empCode",width:80},{title:"직원명",key:"empName",width:80},{title:"부서코드",key:"deptCode",width:80},{title:"부서명",key:"deptName",width:80},{title:"교육 이수 내역",key:"eduHistory",width:110},{title:"승인상태",key:"status",width:80},{title:"검색년도",key:"searchYear",width:80},{title:"반려사유",key:"rejectCause",witdh:80},{title:"비고",key:"etc",witdh:80},{title:"증명서구분",key:"category",witdh:80}];z(()=>{$(),F()});const $=async()=>{await T().FETCH_DEPTLIST(),L.value=Object.values(T().deptList).map(l=>({title:l.deptName,value:l.deptName}))},F=async()=>{await S().FETCH_ALL_EMP(),E.value=Object.values(S().all_emp_list).map(l=>({title:l.empName,value:l.empCode}))},b=async()=>{if(w.value===""||h.value===""||C.value===""||_.value===""){alert("모든 항목을 선택해주세요.");return}await p.get("http://localhost:8282/hr/edu/findEduList",{params:{startDate:h.value,endDate:C.value,empCode:_.value,deptName:w.value}}).then(l=>{D.value=l.data.eduList,console.log("eduList",D.value)}).catch(l=>console.error(l))},M=async l=>{if(s.value.length===0){alert("항목을 선택해주세요.");return}if(l==="승인"&&s.value[0].status==="승인"){alert("이미 승인된 건입니다.");return}const t=l==="승인"?"approval":"cancel",n=l==="승인"?"승인 완료되었습니다.":"승인 취소 완료되었습니다.",d=s.value.map(o=>({...o,status:t}));console.log("updatedRows",d);try{await p.post("http://localhost:8282/hr/edu/approEduList",d),alert(n)}catch(o){console.error(o)}s.value=[],b()},P=()=>{var l;if(s.value.length===0){alert("항목을 선택해주세요.");return}if(((l=s.value[0])==null?void 0:l.status)==="승인"){alert("승인된 건은 반려할 수 없습니다."),s.value=[];return}m.value=!0},A=async()=>{var l;y.value=(l=s.value[0])==null?void 0:l.eduCode,console.log(y.value),await p.patch(`http://localhost:8282/hr/edu/updatePrintDate/${y.value}`).then(t=>{console.log("updateUseDate",t.data)}).catch(t=>console.error(t)),await p.get("http://localhost:8282/hr/edu/",{params:{eduCode:y.value}}).then(t=>{x.value=t.data.printCertificate,console.log("printCertificate.value",x.value),console.log("selectedRows.value",s.value);const n=N.json_to_sheet([x.value]);console.log("certWS",n);const d=N.book_new();N.book_append_sheet(d,n,"certificate"),Q(d,`${new Date}_${s.value[0].empName}_${s.value[0].category}.xlsx`)}).catch(t=>console.error(t)),s.value=[],b()},B=async()=>{const l=s.value.map(t=>({...t,status:"refer",rejectCause:k.value}));console.log("updatedRows",l),await p.post("http://localhost:8282/hr/edu/approEduList",l),m.value=!1,alert("승인 반려 완료되었습니다. "),s.value=[],b()};return(l,t)=>{const n=W,d=H;return G(),Y(K,null,[e(c,null,{default:a(()=>[e(Z,{modelValue:V.value,"onUpdate:modelValue":t[0]||(t[0]=o=>V.value=o),height:"70"},{default:a(()=>[e(ee,{value:"personal-info"},{default:a(()=>[r(" 교육 승인 및 반려 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(c,{flat:""},{default:a(()=>[e(g,null,{default:a(()=>[e(ae,{modelValue:V.value,"onUpdate:modelValue":t[5]||(t[5]=o=>V.value=o),class:"disable-tab-transition"},{default:a(()=>[e(le,{value:"personal-info"},{default:a(()=>[e(c,{class:"mb-6"},{default:a(()=>[e(g,null,{default:a(()=>[e(U,null,{default:a(()=>[e(f,{cols:"12",sm:"2"},{default:a(()=>[e(n,{modelValue:_.value,"onUpdate:modelValue":t[1]||(t[1]=o=>_.value=o),label:"직원명",items:E.value,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"12",sm:"2"},{default:a(()=>[e(n,{modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=o=>w.value=o),label:"부서명",items:L.value,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(f,{cols:"12",sm:"3",mt:"4"},{default:a(()=>[e(d,{modelValue:h.value,"onUpdate:modelValue":t[3]||(t[3]=o=>h.value=o),type:"date",label:"시작일",placeholder:"시작일"},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",sm:"3",mt:"4"},{default:a(()=>[e(d,{modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=o=>C.value=o),type:"date",label:"종료일",placeholder:"종료일"},null,8,["modelValue"])]),_:1}),e(i,{class:"mt-10",onClick:b},{default:a(()=>[r(" 조회 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(c,{class:"mt-6"},{default:a(()=>[e(g,{class:"mt-3 mb-3"},{default:a(()=>[r(" 증명서승인내역 ")]),_:1}),e(q(oe),{modelValue:s.value,"onUpdate:modelValue":t[6]||(t[6]=o=>s.value=o),headers:R,items:D.value,"items-per-page":10,"show-select":"","return-object":"","item-value":"certificateNo"},null,8,["modelValue","items"]),e(U,{class:"text-right mr-3 mb-2 mt-3"},{default:a(()=>[e(f,null,{default:a(()=>[e(i,{class:"mr-2",color:"primary",onClick:t[7]||(t[7]=o=>M("승인"))},{default:a(()=>[r(" 승인 ")]),_:1}),e(i,{color:"primary",class:"mr-2",onClick:P},{default:a(()=>[r(" 승인반려 ")]),_:1}),e(i,{color:"primary",onClick:A},{default:a(()=>[r(" 출력 ")]),_:1})]),_:1})]),_:1})]),_:1}),J("div",de,[e(re,{modelValue:m.value,"onUpdate:modelValue":t[10]||(t[10]=o=>m.value=o),width:"300"},{default:a(()=>[e(c,null,{default:a(()=>[e(g,null,{default:a(()=>[r(" 반려사유를 입력해주세요. ")]),_:1}),e(se,null,{default:a(()=>[e(ue,{modelValue:k.value,"onUpdate:modelValue":t[8]||(t[8]=o=>k.value=o),clearable:"",label:"반려사유",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(te,null,{default:a(()=>[e(i,{color:"primary",onClick:B},{default:a(()=>[r(" 반려 ")]),_:1}),e(i,{color:"primary",onClick:t[9]||(t[9]=o=>m.value=!1)},{default:a(()=>[r(" 닫기 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64)}}});export{$e as default};
