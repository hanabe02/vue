import{_ as F}from"./AppSelect.vue.a2e355e3.js";import{_ as M}from"./AppTextField.vue.badc1057.js";import{d as W,G as A,r as s,o as P,a as I,b as q,e as a,w as t,g as u,V as i,f as z,i as G,F as H}from"./entry.0516b5e8.js";import{b as T}from"./index.c17c83dc.js";import{a as c}from"./axios.28bc18a3.js";import{u as N,w as O}from"./xlsx.f5126985.js";import{u as J}from"./emp.b2d779b9.js";import{V as K,a as Q}from"./VTabs.eb6de54f.js";import{V as d,a as y,c as X}from"./VCard.c238dd74.js";import{V as Y,a as Z}from"./VWindowItem.20662481.js";import{V as U}from"./VRow.a53f6339.js";import{V as b}from"./VCol.c943daa7.js";import{V as ee}from"./VDataTable.781ea32f.js";import{V as ae}from"./VContainer.90c46cbd.js";import{V as te}from"./VTextarea.30e1484f.js";import{V as le}from"./VDialog.83d7608d.js";import"./VCheckboxBtn.759eed6f.js";import"./VDivider.c8eb66ff.js";import"./VSelect.c3f72c74.js";import"./VMenu.8605d140.js";import"./createSimpleFunctional.63f646df.js";import"./VAvatar.dac40cd4.js";import"./index.010e4494.js";/* empty css              */const oe={class:"text-center"},Ue=W({__name:"approval",setup(re){const L=A(),f=J();f.loadEmpCode(),console.log("현재 로그인된 직원 코드:",f.empCode),f.empCode!=="EMP-01"&&f.empCode!=="EMP-00"&&L.push("/hr/confinement/unauthorized");const v=s("personal-info"),V=s(""),S=s([]),h=s([]),_=s(""),C=s(""),o=s([]),g=s(""),m=s(!1),D=s(""),k=s([]),$=[{title:"신청번호",key:"certificateNo"},{title:"신청일자",key:"requestDate"},{title:"사원명",key:"empName"},{title:"증명서구분",key:"category"},{title:"증명서용도",key:"usageName"},{title:"출력일자",key:"useDate"},{title:"승인상태",key:"approvalStatus"}];P(()=>{R()});const R=async()=>{await T().FETCH_DEPTLIST(),S.value=Object.values(T().deptList).map(r=>({title:r.deptName,value:r.deptName}))},w=async()=>{if(V.value===""||_.value===""||C.value===""){alert("모든 항목을 선택해주세요.");return}await c.get("http://localhost:8282/hr/certificate/findCertificateListByDept",{params:{startDate:_.value,endDate:C.value,deptName:V.value}}).then(r=>{h.value=r.data.certificateList,console.log("certificateList",h.value)}).catch(r=>console.error(r))},x=async r=>{if(o.value.length===0){alert("항목을 선택해주세요.");return}if(r==="승인"&&o.value[0].approvalStatus==="승인"){alert("이미 승인된 건입니다.");return}if(r==="승인취소"&&o.value[0].approvalStatus==="승인대기"){alert("승인대기건은 승인취소할 수 없습니다.");return}const e=r==="승인"?"approval":"cancel",p=r==="승인"?"승인 완료되었습니다.":"승인 취소 완료되었습니다.",n=o.value.map(l=>({...l,approvalStatus:e}));console.log("updatedRows",n);try{await c.post("http://localhost:8282/hr/certificate//approvalCertificateList",n),alert(p)}catch(l){console.error(l)}o.value=[],w()},E=()=>{var r;if(o.value.length===0){alert("항목을 선택해주세요.");return}if(((r=o.value[0])==null?void 0:r.approvalStatus)==="승인"){alert("승인된 건은 반려할 수 없습니다."),o.value=[];return}m.value=!0},j=async()=>{const r=o.value.map(e=>({...e,approvalStatus:"refer",rejectCause:D.value}));console.log("updatedRows",r),await c.post("http://localhost:8282/hr/certificate/approvalCertificateList",r),m.value=!1,alert("승인 반려 완료되었습니다. "),o.value=[],w()},B=async()=>{var r;if(o.value.length===0){alert("출력할 증명서를 선택해주세요.");return}if(o.value.length>1){alert("1개의 증명서만 선택해주세요.");return}if(o.value[0].approvalStatus!="승인"){alert("승인된 증명서만 출력가능합니다.");return}if(o.value[0].useDate!=null){alert("이미 출력된 건입니다.");return}g.value=(r=o.value[0])==null?void 0:r.certificateNo,console.log(g.value),await c.patch(`http://localhost:8282/hr/certificate/updateUseDate/${g.value}`).then(e=>{console.log("updateUseDate",e.data)}).catch(e=>console.error(e)),await c.get("http://localhost:8282/hr/certificate/printCertificate",{params:{certificateNo:g.value}}).then(e=>{k.value=e.data.printCertificate,console.log("printCertificate.value",k.value),console.log("selectedRows.value",o.value);const p=N.json_to_sheet([k.value]);console.log("certWS",p);const n=N.book_new();N.book_append_sheet(n,p,"certificate"),O(n,`${new Date}_${o.value[0].empName}_${o.value[0].category}.xlsx`)}).catch(e=>console.error(e)),o.value=[],w()};return(r,e)=>{const p=F,n=M;return I(),q(H,null,[a(d,null,{default:t(()=>[a(K,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),height:"70"},{default:t(()=>[a(Q,{value:"personal-info"},{default:t(()=>[u(" 증명서 관리 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{flat:""},{default:t(()=>[a(y,null,{default:t(()=>[a(Y,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value=l),class:"disable-tab-transition"},{default:t(()=>[a(Z,{value:"personal-info"},{default:t(()=>[a(d,{class:"mb-6"},{default:t(()=>[a(y,null,{default:t(()=>[a(U,null,{default:t(()=>[a(b,{cols:"12",sm:"3"},{default:t(()=>[a(p,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=l=>V.value=l),label:"부서명",items:S.value,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),a(b,{cols:"12",sm:"3",mt:"4"},{default:t(()=>[a(n,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),type:"date",label:"시작일",placeholder:"시작일"},null,8,["modelValue"])]),_:1}),a(b,{cols:"12",sm:"3",mt:"4"},{default:t(()=>[a(n,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=l=>C.value=l),type:"date",label:"종료일",placeholder:"종료일"},null,8,["modelValue"])]),_:1}),a(i,{class:"mt-10",onClick:w},{default:t(()=>[u(" 조회 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(d,{class:"mt-6"},{default:t(()=>[a(y,{class:"mt-3 mb-3"},{default:t(()=>[u(" 증명서승인내역 ")]),_:1}),a(z(ee),{modelValue:o.value,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value=l),headers:$,items:h.value,"items-per-page":10,"show-select":"","return-object":"","item-value":"certificateNo"},null,8,["modelValue","items"]),a(U,{class:"text-right mr-3 mb-2 mt-3"},{default:t(()=>[a(b,null,{default:t(()=>[a(i,{class:"mr-2",color:"primary",onClick:e[6]||(e[6]=l=>x("승인"))},{default:t(()=>[u(" 승인 ")]),_:1}),a(i,{class:"mr-2",color:"primary",onClick:e[7]||(e[7]=l=>x("승인취소"))},{default:t(()=>[u(" 승인취소 ")]),_:1}),a(i,{color:"primary",class:"mr-2",onClick:E},{default:t(()=>[u(" 승인반려 ")]),_:1}),a(i,{color:"primary",onClick:B},{default:t(()=>[u(" 출력 ")]),_:1})]),_:1})]),_:1})]),_:1}),G("div",oe,[a(le,{modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=l=>m.value=l),width:"300"},{default:t(()=>[a(d,null,{default:t(()=>[a(y,null,{default:t(()=>[u(" 반려사유를 입력해주세요. ")]),_:1}),a(ae,null,{default:t(()=>[a(te,{modelValue:D.value,"onUpdate:modelValue":e[8]||(e[8]=l=>D.value=l),clearable:"",label:"반려사유",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(X,null,{default:t(()=>[a(i,{color:"primary",onClick:j},{default:t(()=>[u(" 반려 ")]),_:1}),a(i,{color:"primary",onClick:e[9]||(e[9]=l=>m.value=!1)},{default:t(()=>[u(" 닫기 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64)}}});export{Ue as default};
